Optimizing Black-box Metrics with Adaptive Surrogates